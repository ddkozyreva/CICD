stages:
  - build
  - test_style
  - integration_test
  - deploy

build:
  stage: build
  script:
    - cd src/project/cat/ && make build && cd ../grep/ && make build
    - pwd
  artifacts:
    paths: 
      - src/project/cat/s21_cat
      - src/project/grep/s21_grep
    expire_in: 30 days

style-cat:
  stage: test_style
  needs: ["build"]
  script: 
    - cd src/project/cat/ && clang-format -n -Werror *.c
  when: on_success

style-grep:
  stage: test_style
  needs: ["build"]
  script: 
    - cd src/project/grep/ && clang-format -n -Werror *.c
  when: on_success

test-cat:
  stage: integration_test
  needs: ["build", "style-cat"]
  script: 
    - cd src/project/cat/ && make test
  when: on_success

test-grep:
  stage: integration_test
  needs: ["build", "style-grep"]
  script: 
    - cd src/project/grep/ && make test
  when: on_success
